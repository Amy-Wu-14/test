<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Document</title>
</head>

<body>

    <input id="file" type='file' capture="camera" multiple />
    <div id="picture">
        <video id="video" width="480" height="320" controls>
        </video>
        <div>
            <button id="capture">拍照</button>
        </div>
        <canvas id="canvas" width="480" height="320"></canvas>
    </div>

    <button onclick="alert('成功')">上传</button>
</body>

<script>
    const isMobile = Boolean(/Mobi|Android/i.test(navigator.userAgent))
    if (isMobile) {
        document.body.removeChild(document.getElementById('picture'))
    } else {
        document.body.removeChild(document.getElementById('file'))
        //访问用户媒体设备的兼容方法
        function getUserMedia(constraints, success, error) {
            if (navigator.mediaDevices.getUserMedia) {
                //最新的标准API
                navigator.mediaDevices.getUserMedia(constraints).then(success).catch(error);
            } else if (navigator.webkitGetUserMedia) {
                //webkit核心浏览器
                navigator.webkitGetUserMedia(constraints, success, error)
            } else if (navigator.mozGetUserMedia) {
                //firfox浏览器
                navigator.mozGetUserMedia(constraints, success, error);
            } else if (navigator.getUserMedia) {
                //旧版API
                navigator.getUserMedia(constraints, success, error);
            }
        }

        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');
        let context = canvas.getContext('2d');

        function success(stream) {
            //兼容webkit核心浏览器
            let CompatibleURL = window.URL || window.webkitURL;
            //将视频流设置为video元素的源
            console.log(stream);

            //video.src = CompatibleURL.createObjectURL(stream);
            video.srcObject = stream;
            video.play();
        }

        function error(error) {
            console.log(`访问用户媒体设备失败${error.name}, ${error.message}`);
        }

        if (navigator.mediaDevices?.getUserMedia || navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {
            //调用用户媒体设备, 访问摄像头
            getUserMedia({
                video: {
                    width: 480,
                    height: 320
                }
            }, success, error);
        } else {
            alert('不支持访问用户媒体');
        }

        document.getElementById('capture').addEventListener('click', function () {
            context.drawImage(video, 0, 0, 480, 320);
        })
    }


    // let gyroscope = new Gyroscope();

    // gyroscope.addEventListener('reading', e => {
    //     console.log("Angular velocity along the X-axis " + gyroscope.x);
    //     console.log("Angular velocity along the Y-axis " + gyroscope.y);
    //     console.log("Angular velocity along the Z-axis " + gyroscope.z);
    // });
    // gyroscope.start();
    // gyroscope.onerror = event => console.log(event.error.name, event.error.message);
</script>

</html>